{% extends "layout.html" %}

{% block title %}Dashboard - FocusFlow{% endblock %}

{% block content %}
    <!-- Header part specific to dashboard -->
    <div class="header">
      <div class="date-navigation">
        <button class="btn-tiny" id="prevDateBtn">‹</button>
        <input type="date" id="datePicker" class="date-picker" />
        <button class="btn-tiny" id="nextDateBtn">›</button>
        <div class="date-display" id="currentDate">Loading date...</div>
      </div>
      <div class="focus-mode-toggle" id="focusModeToggle">
        <span>Dark Theme</span>
        <div class="toggle-switch"></div>
      </div>
    </div>
    
    <div class="dashboard-grid">
      <div class="left-column">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Timer</h2>
            <span id="currentTaskLabel" style="color: var(--accent-color); font-size: 0.9em; text-align: right;">No active task</span>
          </div>
          <div class="timer-container">
            <div class="timer-display" id="timerDisplay">00:00:00</div>
            <div class="timer-controls">
              <button class="btn" id="startBtn">Start</button>
              <button class="btn btn-secondary" id="pauseBtn" disabled>Pause</button>
              <button class="btn btn-danger" id="stopBtn" disabled>Stop</button>
            </div>
          </div>
          <div style="margin-top: 20px;">
            <h3 style="font-size: 16px; margin-bottom: 10px; color: var(--text-color);">Select Task:</h3>
            <div class="task-options" id="taskOptions">
              <!-- Task options will be generated by JS -->
              <p style="color: var(--secondary-text); font-size: 0.9em;">Loading tasks...</p>
            </div>
          </div>
        </div>
        
        <div class="card progress-card">
          <div class="card-header">
            <h2 class="card-title">Daily Progress</h2>
          </div>
          <div class="progress-stats">
            <div class="stat-box">
              <div class="stat-value" id="completedTasks">0/0</div>
              <div class="stat-label">Tasks Completed</div>
            </div>
            <div class="stat-box">
              <div class="stat-value" id="timeWorked">0h</div>
              <div class="stat-label">Time Worked</div>
            </div>
            <div class="stat-box">
              <div class="stat-value" id="streakValue">0 days</div>
              <div class="stat-label">Current Streak</div>
            </div>
          </div>
          <div style="margin-top: 20px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
              <span style="color: var(--text-color);">Daily Goal Progress</span>
              <span id="progressPercent" style="color: var(--accent-light);">0%</span>
            </div>
            <div class="progress-bar-container">
              <div class="progress-bar" id="progressBar"></div>
            </div>
          </div>
          
          <div style="margin-top: 30px;"> <!-- Increased margin -->
            <h3 style="font-size: 16px; margin-bottom: 10px; color: var(--text-color);">Weekly Progress</h3>
            <div class="streak-container" id="streakContainer">
              <!-- Streak days will be generated here -->
            </div>
            <div class="streak-labels">
              <span>Mon</span> 
              <span>Tue</span>
              <span>Wed</span>
              <span>Thu</span>
              <span>Fri</span>
              <span>Sat</span>
              <span>Sun</span>
            </div>
          </div>
        </div>
        
        <div class="card">
           <div class="card-header">
            <h2 class="card-title">Notes</h2>
            <button class="btn btn-sm" id="addNoteBtn" style="padding: 8px 16px; font-size: 14px;">+ Add Note</button>
          </div>
          
          <!-- Individual Notes List -->
          <div class="notes-list-container" id="notesListContainer">
            <div id="notesList">
              <!-- Notes will be loaded here -->
            </div>
          </div>
        </div>
      </div>
      
      <div class="right-column">
        <div class="card">
          <div class="card-header" style="align-items: center;">
            <h2 class="card-title">Today's Schedule</h2>
            <div style="display: flex; align-items: center; gap: 15px;">
                <span id="currentTime" style="color: var(--secondary-text)">Loading time...</span>
                <button class="btn btn-sm" id="addTaskBtn" style="padding: 8px 16px; font-size: 14px;">+ Add Task</button>
            </div>
          </div>
          <div class="schedule-container" id="scheduleContainer">
            <div class="schedule-header">
              <div class="schedule-col time-col">Time</div>
              <div class="schedule-col focus-col">Focus & Description</div>
              <div class="schedule-col status-col">Status</div>
              <div class="schedule-col actions-col">Actions</div>
            </div>
            <div class="schedule-body" id="scheduleTableBody">
              <div class="schedule-loading">Loading schedule...</div>
            </div>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Activity Log</h2>
          </div>
          <div class="activity-log" id="activityLog">
            <div class="activity-item" style="text-align:center; color:var(--secondary-text);">Loading activity...</div>
          </div>
        </div>
        
        <div class="card">
           <div class="card-header">
            <h2 class="card-title">Task Summary</h2>
          </div>
          <div class="task-summary">
            <ul class="summary-list" id="taskSummary">
              <li class="summary-item" style="justify-content:center; color:var(--secondary-text);">Loading summary...</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Add/Edit Task Modal -->
    <div id="addTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="addTaskModalTitle">Add New Task</h2>
                <span class="close-btn" id="closeAddTaskModalBtn">×</span>
            </div>
            <form id="addTaskForm">
                <input type="hidden" id="editTaskId" value="">
                <div class="form-group">
                    <label for="newTaskTitle">Title</label>
                    <input type="text" id="newTaskTitle" name="title" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="newTaskDescription">Description (Optional)</label>
                    <textarea id="newTaskDescription" name="description" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="newTaskStartTime">Start Time (Optional, e.g., 09:00)</label>
                    <input type="time" id="newTaskStartTime" name="start_time" class="form-control">
                </div>
                <div class="form-group">
                    <label for="newTaskDuration">Est. Duration (minutes, Optional)</label>
                    <input type="number" id="newTaskDuration" name="duration_minutes" class="form-control" min="1" step="1">
                </div>
                <button type="submit" id="addTaskSubmitBtn" class="btn btn-submit">Add Task</button>
            </form>
        </div>
    </div>

    <!-- Add/Edit Note Modal -->
    <div id="addNoteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="addNoteModalTitle">Add New Note</h2>
                <span class="close-btn" id="closeAddNoteModalBtn">×</span>
            </div>
            <form id="addNoteForm">
                <input type="hidden" id="editNoteId" value="">
                <div class="form-group">
                    <label for="newNoteTitle">Title (Optional)</label>
                    <input type="text" id="newNoteTitle" name="title" class="form-control" placeholder="Note title...">
                </div>
                <div class="form-group">
                    <label for="newNoteType">Type</label>
                    <select id="newNoteType" name="note_type" class="form-control">
                        <option value="general">General</option>
                        <option value="reflection">Reflection</option>
                        <option value="idea">Idea</option>
                        <option value="reminder">Reminder</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newNoteContent">Content</label>
                    <textarea id="newNoteContent" name="content" class="form-control" rows="5" placeholder="Write your note here..." required></textarea>
                </div>
                <button type="submit" id="addNoteSubmitBtn" class="btn btn-submit">Add Note</button>
            </form>
        </div>
    </div>
  
  <div class="notification" id="notification">Notification message!</div>
{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}